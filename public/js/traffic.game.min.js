/*! Traffic 2014-10-09 */
!function(){var a=null,b=function(a){var a=a||{},b=!1,c=a.imageSrc||"",d=new Image,e=function(){};return this.x=0,this.y=0,this.speed=a.speed||0,this.onRender=function(a){return e=a,this},this.render=function(){e()},this.isReady=function(){return b},this.getImage=function(){return d},this.start=function(){return c&&(d.src=c),d.onload=function(){b=!0},this},this},c=function(){var a=this,c={},d=Date.now(),e=Date.now(),f=e-d,g={};this.canvas=document.getElementById("traffic-canvas"),this.ctx=this.canvas.getContext("2d");var h=function(b){38 in g&&(a.entity("hero").y-=a.entity("hero").speed*b),40 in g&&(a.entity("hero").y+=a.entity("hero").speed*b),37 in g&&(a.entity("hero").x-=a.entity("hero").speed*b),39 in g&&(a.entity("hero").x+=a.entity("hero").speed*b)},i=function(){a.entity("hero").x<=a.entity("monster").x+32&&a.entity("monster").x<=a.entity("hero").x+32&&a.entity("hero").y<=a.entity("monster").y+32&&a.entity("monster").y<=a.entity("hero").y+32&&a.reset()};return this.setEntity=function(a,d){return c[a]=new b(d),c[a].start(),c[a]},this.entity=function(a){if(c[a])return c[a];throw new Exception("Could not find Entity '"+a+"'")},this.start=function(){this.setEntity("background",{imageSrc:"images/background.png"}),this.entity("background").onRender(function(){var b=a.entity("background");b.isReady()&&a.ctx.drawImage(a.entity("background").getImage(),0,0)}),this.setEntity("hero",{imageSrc:"images/hero.png",speed:256}),this.entity("hero").onRender(function(){var b=a.entity("hero");b.isReady()&&a.ctx.drawImage(b.getImage(),b.x,b.y)}),this.setEntity("monster",{imageSrc:"images/monster.png"}),this.entity("monster").onRender(function(){var b=a.entity("monster");b.isReady()&&a.ctx.drawImage(b.getImage(),b.x,b.y)}),addEventListener("keydown",function(a){g[a.keyCode]=!0},!1),addEventListener("keyup",function(a){delete g[a.keyCode]},!1),this.main()},this.reset=function(){this.entity("hero").x=this.canvas.width/2,this.entity("hero").y=this.canvas.height/2,this.entity("monster").x=32+Math.random()*(this.canvas.width-64),this.entity("monster").y=32+Math.random()*(this.canvas.height-64)},this.update=function(a){h(a),i(a)},this.render=function(){this.entity("background").render(),this.entity("hero").render(),this.entity("monster").render(),this.ctx.fillStyle="rgb(250, 250, 250)",this.ctx.font="24px Helvetica",this.ctx.textAlign="left",this.ctx.textBaseline="top"},this.main=function(){e=Date.now(),f=e-d,a.update(f/1e3),a.render(),d=e,requestAnimationFrame(a.main)},this};a=new c,a.start()}();